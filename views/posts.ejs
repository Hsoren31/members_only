<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Posts</title>
  </head>
  <body>
    <%- include("partials/header.ejs") %> <% if(!locals.currentUser) { %>
    <div>
      <p>To create a post, you need to <a href="/">login</a> first.</p>
    </div>
    <% if (posts) {%>
    <ul>
      <% posts.forEach(function(post) { %>
      <li>
        <p><%= post.message %></p>
        <p>Anonymous User</p>
      </li>
      <% }); %>
    </ul>
    <%}%> <%} else if(locals.currentUser) {%> <% if (posts) {%>
    <ul>
      <% posts.forEach(function(post) { %>
      <li>
        <p><%= post.message %></p>
        <% if (locals.currentUser.membership_status) {%>
        <p><%= post.first_name %> <%= post.last_name%></p>
        <p><%= post.timestamp %></p>
        <%} else { %>
        <p>Anonymous User</p>
        <%}%> <% if(locals.currentUser.admin_status) {%>
        <form action="posts/<%= post.id%>/delete" method="post">
          <button
            type="submit"
            onclick="return confirm('Are you sure you want to delete this message?');"
          >
            Delete Message
          </button>
        </form>
        <%}%>
      </li>
      <% }); %>
    </ul>
    <%} else {%>
    <p>Be the first to <a href="/posts/new">write</a> a message.</p>
    <%}%> <%}%>
  </body>
</html>
